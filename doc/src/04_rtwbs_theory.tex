% Section 4: RTWBS Theory
\section{Relaxed Weak Timed Bisimulation (RTWBS)}
\subsection{Motivation}
Classical timed bisimulation is often too strict for component refinement where receivers may accept messages over a wider timing window and senders may commit earlier. RTWBS introduces \emph{direction-sensitive} relaxation over weak timed semantics.

\subsection{Classical Timed Bisimulation Recap}
Two timed automata \(A\) and \(B\) are timed bisimilar if there exists a relation \(R\) over states such that \((s_A, s_B) \in R\) implies:
\begin{itemize}
  \item Time: For all delays \(d\), \(s_A \xrightarrow{d} s'_A\) implies \(\exists s'_B\) with \(s_B \xrightarrow{d} s'_B\) and \((s'_A, s'_B) \in R\) (and symmetrically).
  \item Action: For all observable \(a\), \(s_A \xrightarrow{a} s'_A\) implies \(\exists\) matching \(s_B \xrightarrow{a} s'_B\) with \((s'_A, s'_B) \in R\) (and symmetrically).
\end{itemize}
Weak variants replace direct \(a\) by the weak form \(\Rightarrow a \Rightarrow\) where each \(\Rightarrow\) denotes a (possibly empty) sequence of internal (tau) and delay steps.

\subsection{Asymmetric Timing Relaxation}
In RTWBS we distinguish channels with direction (send !, receive ?). Intuition:
\begin{description}
  \item[Send (!)] Refined must not allow more time than abstract before sending: enabling zone refined \(\subseteq\) abstract.
  \item[Receive (?)] Refined may be more permissive: abstract enabling zone \(\subseteq\) refined.
  \item[Internal] Standard weak inclusion refined \(\subseteq\) abstract.
\end{description}
This yields a \emph{preorder} rather than equivalence; mutual refinement recovers a symmetric notion.

\subsection{Formal Rule (Symbolic Form)}
Let \((l_r, Z_r)\) and \((l_a, Z_a)\) be symbolic states with \((l_r, Z_r) \mathcal{R} (l_a, Z_a)\). For each observable action \(a\) performed by refined via transition \(t_r\) with guard \(g_r\) and resets \(R_r\) leading to \((l'_r, Z'_r)\):
\[
  Up(Z_r \cap Inv(l_r) \cap g_r) =: E_r
\]
Similarly for abstract candidate \(t_a\): \(E_a = Up(Z_a \cap Inv(l_a) \cap g_a)\). The timing side condition depends on direction:
\[
  \text{SEND: } E_r \subseteq E_a \quad \text{RECEIVE: } E_a \subseteq E_r \quad \text{INTERNAL: } E_r \subseteq E_a
\]
Then there must exist $t_a$ with same observable label $a$ and direction for which the side condition holds and \(\exists (l''_r, Z''_r) \in post_{weak}(l'_r, Z'_r), (l''_a, Z''_a) \in post_{weak}(l'_a, Z'_a)\) such that \((l''_r, Z''_r) \mathcal{R} (l''_a, Z''_a)\). The converse direction need not hold (refinement).

\subsection{Weak Successors}
Weak post uses $\tau$-closure before and after the observable step: \(post_{weak}(X) = closure_\tau(post_a(closure_\tau(X)))\). Closure enumerates only internal transitions respecting invariants.

\subsection{Soundness Rationale}
The asymmetric inclusion ensures the refined system does not introduce earlier-or-later behaviours violating the abstract specification per direction constraints. Using zones preserves relative timing invariants; extrapolation keeps graph finite without violating inclusion monotonicity.
